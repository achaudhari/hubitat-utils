# Frigate Manager Configuration
# ==============================
# This YAML file configures the notification manager for Frigate NVR events.
# Copy this file to frigate_manager.yml and customize for your setup.

# SMTP Email Configuration
# ------------------------
smtp:
  host: 192.168.1.251
  port: 25
  # username: your-email@gmail.com
  # password: your-app-password
  use_tls: false
  use_ssl: false
  from_address: cameras@heliologic.xyz
  from_name: Frigate Notifier
  timeout: 30

# MQTT Broker Configuration
# -------------------------
mqtt:
  host: mqtt
  port: 1883
  username: frigate-mqtt
  password: ${FRIGATE_MQTT_PASSWORD}
  base_topic: frigate

# Frigate Server Configuration
# ----------------------------
frigate:
  # Authenticated URL (preferred for API calls, port 8971 by default)
  # Requires username/password. Uses JWT token authentication.
  # The manager will automatically login and obtain a JWT token on startup.
  auth_url: http://frigate:8971

  # Unauthenticated URL (fallback, port 5000 by default)
  # Used for internal API calls when auth is not configured or as fallback
  unauth_url: http://frigate:5000

  # External URL (used for links in notification emails)
  # If not set, falls back to auth_url or unauth_url
  external_url: https://cameras.heliologic.xyz

  # Frigate authentication credentials (for JWT token generation)
  # These are the credentials you set up in Frigate's auth system (Settings > Users)
  # The manager will use these to obtain a JWT token via Frigate's /api/login endpoint
  # The token is automatically refreshed before expiration (24 hours by default)
  username: admin
  password: ${FRIGATE_AUTH_PASSWORD}

# Cameras
# -------
cameras:
  DoorbellCam01:
    nice_name: "Front Door"
  OutdoorCam01:
    nice_name: "Side Entrance"
  OutdoorCam02:
    nice_name: "Backyard"
  IndoorCam01:
    nice_name: "Family Room"
  IndoorCam02:
    nice_name: "Living Room"
  IndoorCam03:
    nice_name: "Kitchen"
  IndoorCam04:
    nice_name: "Bedroom"

# Automatic Connectivity Checker
# ------------------------------
connectivity_checker:
  # Interval between connectivity checks (in seconds)
  check_interval_seconds: 120
  # Camera exceptions (always enabled/disabled regardless of connectivity)
  exceptions:
    DoorbellCam01: enabled    # Always keep enabled
    OutdoorCam01: enabled     # Always keep enabled
    OutdoorCam02: enabled     # Always keep enabled

# Notification Rules
# ------------------
# Define rules for when and how to send notifications.
# Rules are evaluated in order; multiple rules can match the same event.
# Each rule has the following available field. Global values in "defaults".
#
# Available fields:
#   camera: Regex pattern for camera name (e.g., 'OutdoorCam.*', 'Indoor.*', or '*' for all)
#   object_type: Regex pattern for object type (e.g., 'person|car', 'dog|cat', or '*' for all)
#   email_to: List of email addresses (overrides default)
#   hysteresis_seconds: Min time between notifications (overrides default)
#   min_score: Minimum confidence score (overrides default)
#   enabled: true/false to enable/disable rule
#   zones: List of zones to match (null = any zone)
#   notify_on_new: Send notification when event starts (default: true)
#   notify_on_end: Send notification when event ends (default: false)
#   include_thumbnail: Embed thumbnail in email (default: true)
#   include_snapshot: Embed full snapshot in email (default: false)
#   include_urls: Include URLs to the event and clip in the notification (default: true)
#   subject_template: Email subject template with {camera}, {label}, {score}, {zones}
#   quiet_hours_start: Start of quiet hours (HH:MM format, e.g., "22:00")
#   quiet_hours_end: End of quiet hours (HH:MM format, e.g., "07:00")
#
# Pattern Matching:
#   - Uses Python regular expressions (case-insensitive)
#   - Examples:
#       'OutdoorCam.*'      - Matches OutdoorCam01, OutdoorCam02, etc.
#       'Indoor(Cam)?.*'    - Matches Indoor01, IndoorCam01, etc.
#       'person|car'        - Matches person OR car
#       '(dog|cat)'         - Matches dog OR cat
#       '.*Cam0[1-3]'       - Matches any camera ending in Cam01, Cam02, or Cam03

notifications:
  defaults: # These apply to all notification rules unless overridden
    email_to:
      - heliologic@mailbox.org
    hysteresis_seconds: 60    # Minimum seconds between notifications per camera/object
    min_score: 0.85           # Minimum confidence score (0.0-1.0)
    include_thumbnail: true   # Do embed thumbnail in email
    include_snapshot: false   # Dont embed full snapshot in email

  rules:  # Rules are evaluated in order; multiple rules can match the same event
    - camera: 'IndoorCam.*'
      object_type: 'dog|cat'
      hysteresis_seconds: 300
      min_score: 0.85
      subject_template: "ğŸ•ğŸ  {camera_nice}: Animal seen inside"

    - camera: 'IndoorCam.*'
      object_type: 'person'
      hysteresis_seconds: 900
      min_score: 0.90
      subject_template: "ğŸ§‘â€ğŸ¦±ğŸ  {camera_nice}: Person seen inside"

    # - camera: 'OutdoorCam.*'
    #   object_type: 'dog|cat'
    #   hysteresis_seconds: 300
    #   min_score: 0.85
    #   subject_template: "ğŸ•ğŸŒ³ {camera_nice}: Animal seen outside"

    - camera: 'OutdoorCam.*'
      object_type: 'person'
      hysteresis_seconds: 900
      min_score: 0.90
      subject_template: "ğŸ§‘â€ğŸ¦±ğŸŒ³ {camera_nice}: Person seen outside"

    - camera: 'DoorbellCam.*'
      object_type: 'person'
      hysteresis_seconds: 120
      min_score: 0.80
      subject_template: "ğŸ§‘â€ğŸ¦±ğŸšª {camera_nice}: Person seen at door"

    # - camera: 'DoorbellCam.*'
    #   object_type: 'dog|cat'
    #   hysteresis_seconds: 600
    #   min_score: 0.50
    #   subject_template: "ğŸ•ğŸšª {camera_nice}: Animal seen at door"

    - camera: 'DoorbellCam.*'
      object_type: 'doorbell_press'
      hysteresis_seconds: 15
      min_score: 0.80
      subject_template: "ğŸ””ğŸšª {camera_nice}: Doorbell rung"
      include_thumbnail: false
      include_urls: false
