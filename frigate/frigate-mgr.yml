# Frigate Manager Configuration
# ==============================
# This YAML file configures the notification manager for Frigate NVR events.
# Copy this file to frigate_manager.yml and customize for your setup.

# SMTP Email Configuration
# ------------------------
smtp:
  host: 192.168.1.251
  port: 25
  # username: your-email@gmail.com
  # password: your-app-password  # Use app-specific password for Gmail
  use_tls: false
  use_ssl: false
  from_address: cameras@heliologic.xyz
  from_name: Frigate Notifier
  timeout: 30

# MQTT Broker Configuration
# -------------------------
mqtt:
  host: mqtt
  port: 1883
  username: frigate-mqtt
  password: ${FRIGATE_MQTT_PASSWORD}
  base_topic: frigate

# Frigate Server Configuration
# ----------------------------
frigate:
  # Authenticated URL (preferred for API calls, port 8971 by default)
  # Requires username/password. Uses JWT token authentication.
  # The manager will automatically login and obtain a JWT token on startup.
  auth_url: http://frigate:8971

  # Unauthenticated URL (fallback, port 5000 by default)
  # Used for internal API calls when auth is not configured or as fallback
  unauth_url: http://frigate:5000

  # External URL (used for links in notification emails)
  # If not set, falls back to auth_url or unauth_url
  external_url: https://cameras.heliologic.xyz

  # Frigate authentication credentials (for JWT token generation)
  # These are the credentials you set up in Frigate's auth system (Settings > Users)
  # The manager will use these to obtain a JWT token via Frigate's /api/login endpoint
  # The token is automatically refreshed before expiration (24 hours by default)
  username: admin
  password: ${FRIGATE_AUTH_PASSWORD}

# Automatic Connectivity Checker
# ------------------------------
connectivity_checker:
  exceptions:
    DoorbellCam01: enabled    # Always keep enabled
    OutdoorCam01: enabled     # Always keep enabled
    OutdoorCam02: enabled     # Always keep enabled

# Default Settings
# ----------------
# These apply to all notification rules unless overridden
defaults:
  email_to:
    - heliologic@mailbox.org
  hysteresis_seconds: 60    # Minimum seconds between notifications per camera/object
  min_score: 0.7            # Minimum confidence score (0.0-1.0)
  include_thumbnail: true   # Do embed thumbnail in email
  include_snapshot: false   # Dont embed full snapshot in email

# Notification Rules
# ------------------
# Define rules for when and how to send notifications.
# Rules are evaluated in order; multiple rules can match the same event.
#
# Available fields:
#   camera: Regex pattern for camera name (e.g., 'OutdoorCam.*', 'Indoor.*', or '*' for all)
#   object_type: Regex pattern for object type (e.g., 'person|car', 'dog|cat', or '*' for all)
#   email_to: List of email addresses (overrides default)
#   hysteresis_seconds: Min time between notifications (overrides default)
#   min_score: Minimum confidence score (overrides default)
#   enabled: true/false to enable/disable rule
#   zones: List of zones to match (null = any zone)
#   notify_on_new: Send notification when event starts (default: true)
#   notify_on_end: Send notification when event ends (default: false)
#   include_thumbnail: Embed thumbnail in email (default: true)
#   include_snapshot: Embed full snapshot in email (default: false)
#   subject_template: Email subject template with {camera}, {label}, {score}, {zones}
#   quiet_hours_start: Start of quiet hours (HH:MM format, e.g., "22:00")
#   quiet_hours_end: End of quiet hours (HH:MM format, e.g., "07:00")
#
# Pattern Matching:
#   - Uses Python regular expressions (case-insensitive)
#   - Examples:
#       'OutdoorCam.*'      - Matches OutdoorCam01, OutdoorCam02, etc.
#       'Indoor(Cam)?.*'    - Matches Indoor01, IndoorCam01, etc.
#       'person|car'        - Matches person OR car
#       '(dog|cat)'         - Matches dog OR cat
#       '.*Cam0[1-3]'       - Matches any camera ending in Cam01, Cam02, or Cam03

notifications:
  - camera: 'IndoorCam.*'
    object_type: 'dog|cat'
    hysteresis_seconds: 120
    min_score: 0.85
    subject_template: "üêï [{camera}] Animal detected"

  - camera: 'IndoorCam.*'
    object_type: 'person'
    hysteresis_seconds: 600
    min_score: 0.85
    subject_template: "üßç [{camera}] Person detected"

  - camera: 'OutdoorCam.*'
    object_type: 'dog|cat'
    hysteresis_seconds: 600
    min_score: 0.85
    subject_template: "üêï [{camera}] Animal detected"

  - camera: 'OutdoorCam.*'
    object_type: 'person'
    hysteresis_seconds: 120
    min_score: 0.85
    subject_template: "üßç [{camera}] Person detected"

# notifications:
#   # High priority: Person detection on outdoor cameras
#   - camera: OutdoorCam01
#     object_type: person
#     email_to:
#       - security@example.com
#       - homeowner@example.com
#     hysteresis_seconds: 30
#     min_score: 0.7
#     notify_on_new: true
#     include_thumbnail: true
#     include_snapshot: true
#     subject_template: "üö® [{camera}] Person detected ({score})"

#   - camera: OutdoorCam02
#     object_type: person
#     email_to:
#       - security@example.com
#     hysteresis_seconds: 30
#     min_score: 0.7
#     subject_template: "üö® [{camera}] Person detected"

#   # Vehicle detection - driveway camera only
#   - camera: OutdoorCam01
#     object_type: car
#     email_to:
#       - homeowner@example.com
#     hysteresis_seconds: 120  # Less frequent for cars
#     min_score: 0.6
#     zones:
#       - driveway
#     subject_template: "üöó [{camera}] Vehicle in driveway"

#   # Pet detection on all indoor cameras
#   - camera: IndoorCam01
#     object_type: dog
#     email_to:
#       - pet-alerts@example.com
#     hysteresis_seconds: 300  # Every 5 minutes max
#     min_score: 0.75
#     quiet_hours_start: "22:00"
#     quiet_hours_end: "07:00"
#     subject_template: "üêï [{camera}] Dog detected"

#   - camera: IndoorCam01
#     object_type: cat
#     email_to:
#       - pet-alerts@example.com
#     hysteresis_seconds: 300
#     min_score: 0.75
#     quiet_hours_start: "22:00"
#     quiet_hours_end: "07:00"
#     subject_template: "üê± [{camera}] Cat detected"

#   # Wildcard rule: Any person on any camera (lower priority/longer hysteresis)
#   - camera: '*'
#     object_type: person
#     email_to:
#       - general-alerts@example.com
#     hysteresis_seconds: 300
#     min_score: 0.8
#     subject_template: "[{camera}] Person detected"

#   # Zone-specific rule: Front door zone only
#   - camera: OutdoorCam01
#     object_type: person
#     zones:
#       - front_door
#       - porch
#     email_to:
#       - doorbell@example.com
#     hysteresis_seconds: 60
#     min_score: 0.65
#     subject_template: "üö™ Someone at the front door"

#   # Example: Disabled rule (won't trigger)
#   - camera: IndoorCam02
#     object_type: person
#     enabled: false
#     email_to:
#       - disabled@example.com
#     subject_template: "This rule is disabled"
